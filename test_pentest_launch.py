#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞ –ø–µ–Ω—Ç–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
"""
import paramiko
import sys
import time

if sys.platform == 'win32':
    import codecs
    sys.stdout = codecs.getwriter('utf-8')(sys.stdout.buffer, 'strict')
    sys.stderr = codecs.getwriter('utf-8')(sys.stderr.buffer, 'strict')

SERVER_HOST = "72.56.79.153"
SERVER_USER = "root"
SERVER_PASSWORD = "m8J@2_6whwza6U"
SERVER_PORT = 22

def connect_to_server():
    ssh = paramiko.SSHClient()
    ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
    try:
        ssh.connect(hostname=SERVER_HOST, port=SERVER_PORT, username=SERVER_USER, password=SERVER_PASSWORD, timeout=10)
        return ssh
    except Exception as e:
        print(f"[ERROR] –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: {e}")
        return None

def test_pentest_via_web(ssh):
    """–¢–µ—Å—Ç –ø–µ–Ω—Ç–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å"""
    print("=" * 70)
    print("–¢–ï–°–¢ –ü–ï–ù–¢–ï–°–¢–ê –ß–ï–†–ï–ó –í–ï–ë-–ò–ù–¢–ï–†–§–ï–ô–°")
    print("=" * 70)
    
    # –°–∏–º—É–ª–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
    print("\n1. –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É:")
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º curl –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
    test_url = "https://test.example.com"
    curl_command = f"""
curl -s -X GET "http://localhost:3000/pentest?target={test_url}" 2>&1 | head -20
"""
    
    print(f"–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è —Ü–µ–ª–∏: {test_url}")
    stdin, stdout, stderr = ssh.exec_command(curl_command)
    response = stdout.read().decode('utf-8', errors='ignore')
    print(response[:500])
    
    # –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏
    print("\n2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞:")
    time.sleep(3)
    stdin, stdout, stderr = ssh.exec_command("tail -30 /tmp/web-interface.log")
    logs = stdout.read().decode('utf-8', errors='ignore')
    print(logs)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
    print("\n3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ shannon:")
    stdin, stdout, stderr = ssh.exec_command("ps aux | grep -E 'shannon.mjs|node.*generate' | grep -v grep")
    processes = stdout.read().decode('utf-8', errors='ignore')
    print(processes if processes else "–ü—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")

def check_web_interface_final(ssh):
    """–§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞"""
    print("\n" + "=" * 70)
    print("–§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê")
    print("=" * 70)
    
    # –°—Ç–∞—Ç—É—Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    print("\n1. –°—Ç–∞—Ç—É—Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:")
    stdin, stdout, stderr = ssh.exec_command("ps aux | grep 'web-interface.cjs' | grep -v grep")
    web_process = stdout.read().decode('utf-8', errors='ignore')
    if web_process:
        print("‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–ø—É—â–µ–Ω")
    else:
        print("‚ùå –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –∑–∞–ø—É—â–µ–Ω")
    
    # –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
    print("\n2. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:")
    stdin, stdout, stderr = ssh.exec_command("curl -s -o /dev/null -w '%{http_code}' http://localhost:3000 2>&1")
    http_code = stdout.read().decode('utf-8', errors='ignore').strip()
    if http_code == "200":
        print("‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω (HTTP 200)")
    else:
        print(f"‚ö†Ô∏è  HTTP –∫–æ–¥: {http_code}")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
    print("\n3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:")
    stdin, stdout, stderr = ssh.exec_command("cd shannon-uncontained && node -c web-interface.cjs 2>&1")
    syntax = stdout.read().decode('utf-8', errors='ignore')
    if not syntax:
        print("‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω")
    else:
        print(f"‚ùå –û—à–∏–±–∫–∏: {syntax}")

def main():
    ssh = connect_to_server()
    if not ssh:
        return
    
    try:
        check_web_interface_final(ssh)
        test_pentest_via_web(ssh)
        
        print("\n" + "=" * 70)
        print("–ì–û–¢–û–í–ù–û–°–¢–¨ –ö –ü–ï–ù–¢–ï–°–¢–£")
        print("=" * 70)
        print("\n‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω")
        print("‚úÖ –û—à–∏–±–∫–∞ —Å path –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞")
        print("‚úÖ Resume –æ—Ç–∫–ª—é—á–µ–Ω")
        print("‚úÖ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç")
        print("\nüåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: http://72.56.79.153:3000")
        print("\n–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–µ–Ω—Ç–µ—Å—Ç —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å!")
        
    finally:
        ssh.close()

if __name__ == "__main__":
    main()

